{"version":3,"file":"tplink-lightbulb.umd.js","sources":["../src/index.js"],"sourcesContent":["import dgram from 'dgram'\nimport EventEmitter from 'events'\n\nexport default class TPLSmartDevice {\n  constructor (ip) {\n    this.ip = ip\n  }\n\n  // Scan for lightbulbs on your network\n  static scan (filter, broadcast = '255.255.255.255') {\n    const emitter = new EventEmitter()\n    const client = dgram.createSocket({\n      type: 'udp4',\n      reuseAddr: true\n    })\n    client.bind(9998, undefined, () => {\n      client.setBroadcast(true)\n      const msgBuf = TPLSmartDevice.encrypt(Buffer.from('{\"system\":{\"get_sysinfo\":{}}}'))\n      client.send(msgBuf, 0, msgBuf.length, 9999, broadcast)\n    })\n    client.on('message', (msg, rinfo) => {\n      const decryptedMsg = this.decrypt(msg).toString('ascii')\n      const jsonMsg = JSON.parse(decryptedMsg)\n      const sysinfo = jsonMsg.system.get_sysinfo\n\n      if (filter && sysinfo.mic_type !== filter) {\n        return\n      }\n\n      const light = new TPLSmartDevice(rinfo.address)\n      light._info = rinfo\n      light._sysinfo = sysinfo\n      light.host = rinfo.address\n      light.port = rinfo.port\n      light.name = sysinfo.alias\n      light.deviceId = sysinfo.deviceId\n\n      emitter.emit('light', light)\n    })\n    emitter.stop = () => client.close()\n    return emitter\n  }\n\n  // Send a message to a lightbulb (for RAW JS message objects)\n  send (msg) {\n    return new Promise((resolve, reject) => {\n      if (!this.ip) {\n        return reject(new Error('IP not set.'))\n      }\n      const client = dgram.createSocket('udp4')\n      const message = this.encrypt(Buffer.from(JSON.stringify(msg)))\n      client.send(message, 0, message.length, 9999, this.ip, (err, bytes) => {\n        if (err) {\n          return reject(err)\n        }\n        client.on('message', msg => {\n          resolve(JSON.parse(this.decrypt(msg).toString()))\n          client.close()\n        })\n      })\n    })\n  }\n\n  // TODO: wifi needs more testing. it seems very broken.\n\n  // Scans the wifi networks in range of the device\n  async listwifi () {\n    const r1 = await this.send({\n      netif: {\n        get_scaninfo: {\n          refresh: 1\n        }\n      }\n    })\n\n    if (r1?.netif?.get_scaninfo?.ap_list) {\n      return r1.netif.get_scaninfo.ap_list\n    } else {\n      // on fail, try older message-format\n      const r2 = await this.send({\n        'smartlife.iot.common.softaponboarding': {\n          get_scaninfo: {\n            refresh: 1\n          }\n        }\n      })\n      if (r2 && r2['smartlife.iot.common.softaponboarding']?.get_scaninfo?.ap_list) {\n        return r2['smartlife.iot.common.softaponboarding'].get_scaninfo.ap_list\n      }\n    }\n  }\n\n  // Connects the device to the access point in the parameters\n  async connectwifi (ssid, password, keyType = 1, cypherType = 0) {\n    const r1 = await this.send({\n      netif: {\n        set_stainfo: {\n          cypher_type: cypherType,\n          key_type: keyType,\n          password,\n          ssid\n        }\n      }\n    })\n\n    if (r1?.netif?.set_stainfo?.err_code === 0) {\n      return true\n    }\n\n    // on fail, try older message-format\n\n    const r2 = await this.send({\n      'smartlife.iot.common.softaponboarding': {\n        set_stainfo: {\n          cypher_type: cypherType,\n          key_type: keyType,\n          password,\n          ssid\n        }\n      }\n    })\n    if (r2['smartlife.iot.common.softaponboarding'] && r2['smartlife.iot.common.softaponboarding'].err_msg) {\n      throw new Error(r2['smartlife.iot.common.softaponboarding'].err_msg)\n    } else {\n      return true\n    }\n  }\n\n  // Get info about the TPLSmartDevice\n  async info () {\n    const r = await this.send({ system: { get_sysinfo: {} } })\n    return r.system.get_sysinfo\n  }\n\n  // Set power-state of lightbulb\n  async power (powerState = true, transition = 0, options = {}) {\n    const info = await this.info()\n    if (typeof info.relay_state !== 'undefined') {\n      return this.send({\n        system: {\n          set_relay_state: {\n            state: powerState ? 1 : 0\n          }\n        }\n      })\n    } else {\n      const r = await this.send({\n        'smartlife.iot.smartbulb.lightingservice': {\n          transition_light_state: {\n            ignore_default: 1,\n            on_off: powerState ? 1 : 0,\n            transition_period: transition,\n            ...options\n          }\n        }\n      })\n      return r['smartlife.iot.smartbulb.lightingservice'].transition_light_state\n    }\n  }\n\n  // Set led-state of lightbulb\n  led (ledState = true) {\n    return this.send({ system: { set_led_off: { off: ledState ? 0 : 1 } } })\n  }\n\n  // Set the name of lightbulb\n  async setName (newAlias) {\n    const info = await this.info()\n    return typeof info.dev_name !== 'undefined'\n      ? this.send({ system: { set_dev_alias: { alias: newAlias } } })\n      : this.send({ 'smartlife.iot.common.system': { set_dev_alias: { alias: newAlias } } })\n  }\n\n  // Get schedule info\n  async daystat (month, year) {\n    const now = new Date()\n    month = month || now.getMonth() + 1\n    year = year || now.getFullYear()\n    const r = await this.send({ 'smartlife.iot.common.schedule': { get_daystat: { month: month, year: year } } })\n    return r['smartlife.iot.common.schedule'].get_daystat\n  }\n\n  // Get cloud info from bulb\n  async cloud () {\n    const r = await this.send({ 'smartlife.iot.common.cloud': { get_info: {} } })\n    return r['smartlife.iot.common.cloud'].get_info\n  }\n\n  // Get schedule from bulb\n  async schedule () {\n    const r = await this.send({ 'smartlife.iot.common.schedule': { get_rules: {} } })\n    return r['smartlife.iot.common.schedule'].get_rules\n  }\n\n  // Get operational details from bulb\n  details () {\n    return this.send({ 'smartlife.iot.smartbulb.lightingservice': { get_light_details: {} } })\n  }\n\n  //  Reboot the device\n  reboot () {\n    return this.send({ 'smartlife.iot.common.system': { reboot: { delay: 1 } } })\n  }\n\n  // Badly encrypt message in format bulbs use\n  static encrypt (buffer, key = 0xAB) {\n    for (let i = 0; i < buffer.length; i++) {\n      const c = buffer[i]\n      buffer[i] = c ^ key\n      key = buffer[i]\n    }\n    return buffer\n  }\n\n  encrypt (buffer, key) {\n    return TPLSmartDevice.encrypt(buffer, key)\n  }\n\n  // Badly decrypt message from format bulbs use\n  static decrypt (buffer, key = 0xAB) {\n    for (let i = 0; i < buffer.length; i++) {\n      const c = buffer[i]\n      buffer[i] = c ^ key\n      key = c\n    }\n    return buffer\n  }\n\n  decrypt (buffer, key) {\n    return TPLSmartDevice.decrypt(buffer, key)\n  }\n}\n"],"names":["TPLSmartDevice","constructor","ip","scan","filter","broadcast","emitter","EventEmitter","client","dgram","createSocket","type","reuseAddr","bind","undefined","setBroadcast","msgBuf","encrypt","Buffer","from","send","length","on","msg","rinfo","decryptedMsg","decrypt","toString","jsonMsg","JSON","parse","sysinfo","system","get_sysinfo","mic_type","light","address","_info","_sysinfo","host","port","name","alias","deviceId","emit","stop","close","Promise","resolve","reject","Error","message","stringify","err","bytes","listwifi","r1","netif","get_scaninfo","refresh","ap_list","r2","connectwifi","ssid","password","keyType","cypherType","set_stainfo","cypher_type","key_type","err_code","err_msg","info","r","power","powerState","transition","options","relay_state","set_relay_state","state","transition_light_state","ignore_default","on_off","transition_period","led","ledState","set_led_off","off","setName","newAlias","dev_name","set_dev_alias","daystat","month","year","now","Date","getMonth","getFullYear","get_daystat","cloud","get_info","schedule","get_rules","details","get_light_details","reboot","delay","buffer","key","i","c"],"mappings":"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"}